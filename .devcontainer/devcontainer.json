{
  "name": "PyTorch-dev",
  "dockerComposeFile": "../docker-compose.yml",
  // "build": {
    // "dockerfile": "Dockerfile",
    // "context": "."
  // },

  "containerEnv": {
    "UV_PROJECT_ENVIRONMENT": "/opt/venv",
    // "UV_LINK_MODE": "copy"
  },
  
  "service": "app",
  "workspaceFolder": "/workspace",
  // "remoteUser": "root",

  "customizations": {
    "vscode": {
      "extensions": [
        "ms-python.python",
        "ms-toolsai.jupyter",
        // "ms-azuretools.vscode-docker"
      ]
      // "settings": {
      //   // "python.defaultInterpreterPath": "/usr/bin/python"
      //   "python.defaultInterpreterPath": ".venv/bin/python"
      // }
    }
  },

  "forwardPorts": [8888],
	"portsAttributes": {
		"8888": {
			"label": "Jupyter",
			"requireLocalPort": true,
			"onAutoForward": "ignore"
		}
	},
  // "mounts": [
    // LOCAL MAC: change source to ${localWorkspaceFolder}/.data if you prefer
// /    "source=${localWorkspaceFolder}/.data,target=/data,type=bind"
    // Cloud version
    // "source=/data,target=/data,type=bind"
  // ],

  // "forwardPorts": [8188],
   "postCreateCommand": "bash -lc '[ -x /opt/venv/bin/python ] || uv venv /opt/venv; UV_PROJECT_ENVIRONMENT=/opt/venv uv sync --frozen; grep -qxF \"[ -x /opt/venv/bin/activate ] && source /opt/venv/bin/activate\" ~/.bashrc || echo \"[ -x /opt/venv/bin/activate ] && source /opt/venv/bin/activate\" >> ~/.bashrc'",

  "postStartCommand": "bash -lc '[ -x /opt/venv/bin/python ] || (uv venv /opt/venv && UV_PROJECT_ENVIRONMENT=/opt/venv uv sync --frozen)' || jupyter notebook --ip 0.0.0.0 --port 8888 --no-browser --allow-root",

  "postAttachCommand": "bash -lc 'source /opt/venv/bin/activate || true' && echo '[postAttach] container attached'",

  "overrideCommand": false,
  // "postCreateCommand": "bash"
}
