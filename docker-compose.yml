services:
  app:
    build:
      context: .
      dockerfile: .devcontainer/Dockerfile
    working_dir: /workspace
    ports:
      - "8888:8888"
    volumes:
      - .:/workspace:cached
      - venv:/opt/venv
    environment:
      - PYTHONUNBUFFERED=1
      - UV_PROJECT_ENVIRONMENT=/opt/venv

    # Keep container alive for Dev Containers to attach reliably
    # command:
    #   - sh
    #   - -lc
    #   - >
    #     set -euo pipefail;
    #     if [ ! -x /opt/venv/bin/python ]; then
    #       uv venv /opt/venv &&
    #       UV_PROJECT_ENVIRONMENT=/opt/venv uv sync --frozen;
    #     fi;
    #     exec /opt/venv/bin/jupyter lab
    #       --ip=0.0.0.0
    #       --port=8888
    #       --no-browser
    #       --allow-root
    #       --ServerApp.token=""
    #       --ServerApp.password=""
    #       --ServerApp.root_dir=/workspace
volumes:
  venv:
  uvcache: